// This file was generated by SquareLine Studio
// SquareLine Studio version: SquareLine Studio 1.5.2
// LVGL version: 8.3.11
// Project name: ChirpyUI

#include "ui.h"
#include "common.h"
#include "structs.h"
#include <esp_err.h>
#include "esp_log.h"
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"


void successAnimationFunc(lv_obj_t *TargetObject)
{
	// Unhide and reset opacity
	lv_obj_clear_flag(TargetObject, LV_OBJ_FLAG_HIDDEN);
	lv_obj_set_style_opa(TargetObject, LV_OPA_TRANSP, 0); // Start transparent

	// Start the animation
	MessageSentSuccessStart_Animation(TargetObject, 0);

}

void loraEmergency(lv_event_t *e)
{
	successAnimationFunc(ui_EmergencySuccessImage);
	if (common_sendLoraAlert(false) == ESP_OK)
	{
		// maybe do something here
	}
}

void loraSendLike(lv_event_t * e)
{
	successAnimationFunc(ui_MessageSendCheckMark);
	if (common_sendLoraEmoji(THUMB_UP, false) == ESP_OK)
	{
		//maybe do something here
	}
}

void loraSendWave(lv_event_t * e)
{
	successAnimationFunc(ui_MessageSendCheckMark);
	if (common_sendLoraEmoji(WAVE, false) == ESP_OK)
	{
		//maybe do something here
	}
}

void loraSendHeart(lv_event_t * e)
{
	successAnimationFunc(ui_MessageSendCheckMark);
	if (common_sendLoraEmoji(HEART, false) == ESP_OK)
	{
		//maybe do something here
	}
}

void loraSendParty(lv_event_t * e)
{
	successAnimationFunc(ui_MessageSendCheckMark);
	if (common_sendLoraEmoji(PARTY, false) == ESP_OK)
	{
		//maybe do something here
	}
}

void loraSendMessageFromBox(lv_event_t * e)
{
	const char *text = lv_textarea_get_text(ui_MessageInputBox);
	if (common_sendLoraMessage(text, false) == ESP_OK)
	{
		lv_obj_clear_flag(ui_MessageSendCheckMark, LV_OBJ_FLAG_HIDDEN);
		lv_obj_set_style_opa(ui_MessageSendCheckMark, LV_OPA_0, LV_PART_MAIN | LV_STATE_DEFAULT);

		lv_textarea_set_text(ui_MessageInputBox, ""); // clear input box after sending
		lv_textarea_set_placeholder_text(ui_MessageInputBox, "Type a message...");
		MessageSentSuccessStart_Animation(ui_MessageSendCheckMark, 0);
		MessageSentSuccessEnd_Animation(ui_MessageSendCheckMark, 0);
		lv_obj_add_flag(ui_MessageSendCheckMark, LV_OBJ_FLAG_HIDDEN);
	}
}

void loraChangeGroup(lv_event_t * e)
{
	char buf[16]; // buffer for the selected text
	lv_roller_get_selected_str(ui_GroupSelector, buf, sizeof(buf));
	ESP_LOGI("UI", "Selected roller item: %s", buf);

	// format "Gr. x", extract the number
	int group = 0;
	if (sscanf(buf, "Gr. %d", &group) == 1)
	{
		if (group >= 0 && group <= 9)
		{
			globalUserData.groupId = group;
			ESP_LOGI("UI", "Updated globalUserData.groupId to %d", group);
			ui_request_sync(globalUserData.userId, globalUserData.groupId);
		}
		else
		{
			ESP_LOGW("UI", "Group number out of range: %d", group);
		}
	}
	else
	{
		ESP_LOGW("UI", "Failed to parse group number from: %s", buf);
	}
}

void ChangeUserPiggy(lv_event_t * e)
{
	globalUserData.userId = PIGGY;
	ui_request_sync(globalUserData.userId, globalUserData.groupId);
	successAnimationFunc(ui_AvatarUpdateSuccessImage);
}

void ChangeUserFroggy(lv_event_t * e)
{
	globalUserData.userId = FROGGY;
	ui_request_sync(globalUserData.userId, globalUserData.groupId);
	successAnimationFunc(ui_AvatarUpdateSuccessImage);
}

void ChangeUserHorsy(lv_event_t * e)
{
	globalUserData.userId = HORSY;
	ui_request_sync(globalUserData.userId, globalUserData.groupId);
	successAnimationFunc(ui_AvatarUpdateSuccessImage);
}

void ChangeUserPandy(lv_event_t * e)
{
	globalUserData.userId = PANDY;
	ui_request_sync(globalUserData.userId, globalUserData.groupId);
	successAnimationFunc(ui_AvatarUpdateSuccessImage);
}

void ChangeBrightess(lv_event_t * e)
{
	common_setBrightness(lv_slider_get_value(ui_BrightnessSlider));
}

void ChangeUserPhoeny(lv_event_t * e)
{
	globalUserData.userId = PHOENY;
	ui_request_sync(globalUserData.userId, globalUserData.groupId);
	successAnimationFunc(ui_AvatarUpdateSuccessImage);
}

void ChangeUserLizzy(lv_event_t * e)
{
	globalUserData.userId = LIZZY;
	ui_request_sync(globalUserData.userId, globalUserData.groupId);
	successAnimationFunc(ui_AvatarUpdateSuccessImage);
}

void ChangeUserPuppy(lv_event_t * e)
{
	globalUserData.userId = PUPPY;
	ui_request_sync(globalUserData.userId, globalUserData.groupId);
	successAnimationFunc(ui_AvatarUpdateSuccessImage);
}

void ChangeUserKitty(lv_event_t * e)
{
	globalUserData.userId = KITTY;
	ui_request_sync(globalUserData.userId, globalUserData.groupId);
	successAnimationFunc(ui_AvatarUpdateSuccessImage);
}

void Vibration_Enable(lv_event_t * e)
{
	common_setVibration(true);
}

void Vibration_Disable(lv_event_t * e)
{
	common_setVibration(false);
}

void Sound_Enable(lv_event_t * e)
{
	// Your code here
}

void Sound_Disable(lv_event_t * e)
{
	// Your code here
}
